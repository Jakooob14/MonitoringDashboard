@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Identity
@using MonitoringDashboard.Components.Shared.ContextMenu
@using MonitoringDashboard.Data.Models
@inject AuthenticationStateProvider AuthStateProvider
@inject IServiceScopeFactory ScopeFactory
@rendermode InteractiveServer

<aside class="fixed w-[320px] h-screen bg-neutral-800 p-8">
    <div class="flex flex-col justify-between h-full">
        <ul class="flex flex-col gap-y-4">
            <li>
                <NavLink Href="/" class="text-2xl text-center">Monitoring Dashboard</NavLink>
                <hr class="border border-zinc-700 mt-4"/>
            </li>
            <li><SidepanelButton Text="Services" IconPath="icons/service.svg" Href="/dashboard/services"/></li>
            <li><SidepanelButton Text="Maintenance" IconPath="icons/wrench.svg" Href="/dashboard/maintenance"/></li>
            <AuthorizeView Roles="Admin">
                <li><SidepanelButton Text="Users" IconPath="icons/users.svg" Href="/dashboard/users"/></li>
            </AuthorizeView>
        </ul>
        @if (_currentUser != null)
        {
            <div class="relative">
                <hr class="border-zinc-700 my-4" />
                <div class="flex flex-col gap-y-1 hover:bg-zinc-900 transition-colors w-full p-3 rounded cursor-pointer text-zinc-100" @onclick="() => _isContextMenuOpen = true">
                    <span class="font-medium text-xl text-ellipsis whitespace-nowrap overflow-hidden">@_currentUser.UserName</span>
                    <span class="text-ellipsis whitespace-nowrap overflow-hidden">@_currentUser.Email</span>
                </div>
                @if (_isContextMenuOpen)
                {
                    <ContextMenu Items="_contextMenuItems" OnClose="() => _isContextMenuOpen = false"/>
                }
            </div>
        }
    </div>
</aside>