@using Microsoft.AspNetCore.Components.Authorization
@using MonitoringDashboard.Components.Shared.ContextMenu
@using MonitoringDashboard.Helpers
@using MonitoringDashboard.Services
@inject IUserContextService UserContextService
@rendermode InteractiveServer

@* <div class="absolute top-0 left-0 m-4 w-8 h-8 rounded-full bg-neutral-900 border border-zinc-.700 flex justify-center items-center z-10" @onclick="() => { _sidebarOpen = !_sidebarOpen; StateHasChanged(); }">-</div> *@
<aside class="fixed w-full xl:w-[320px] h-screen bg-neutral-800 p-8 flex flex-col justify-between xl:left-0 @(_sidebarOpen ? "left-0" : "-left-full") transition-[left] z-10">
    <div class="flex flex-col justify-between h-full">
        <ul class="flex flex-col gap-y-4">
            <li>
                <NavLink Href="/" class="text-2xl text-center">@AppConfig.AppName</NavLink>
                <hr class="border border-zinc-700 mt-4"/>
            </li>
            <li><SidepanelButton Text="Services" IconPath="icons/service.svg" Href="/dashboard/services"/></li>
            <li><SidepanelButton Text="Maintenances" IconPath="icons/wrench.svg" Href="/dashboard/maintenances"/></li>
            <AuthorizeView Roles="Admin">
                <li><SidepanelButton Text="Users" IconPath="icons/users.svg" Href="/dashboard/users"/></li>
            </AuthorizeView>
        </ul>
        @if (_currentUser != null)
        {
            <div class="relative mb-12 xl:mb-0">
                <hr class="border-zinc-700 my-4"/>
                <div class="flex flex-col gap-y-1 hover:bg-zinc-900 transition-colors w-full p-3 rounded cursor-pointer text-zinc-100" @onclick="() => _isContextMenuOpen = true">
                    <span class="font-medium text-xl text-ellipsis whitespace-nowrap overflow-hidden">@_currentUser.UserName</span>
                    <span class="text-ellipsis whitespace-nowrap overflow-hidden">@_currentUser.Email</span>
                </div>
                @if (_isContextMenuOpen)
                {
                    <ContextMenu class="left-1/2 -translate-x-1/2 -top-[70%]! w-full xl:w-auto" Items="_contextMenuItems" OnClose="() => _isContextMenuOpen = false"/>
                }
            </div>
        }
    </div>
</aside>
<div class="fixed w-full h-16 bg-neutral-800 bottom-0 left-0 flex justify-evenly items-center xl:hidden z-10 border-t border-zinc-700">
    <SidepanelButton IconPath="icons/service.svg" 
                     Href="/dashboard/services" 
                     style="background-color: #ffffff00; justify-content: center; width: min-content;" 
                     @onclick="() => { _sidebarOpen = false; StateHasChanged(); }"/>
    <SidepanelButton IconPath="icons/wrench.svg" 
                     Href="/dashboard/maintenances" 
                     style="background-color: #ffffff00; justify-content: center; width: min-content;" 
                     @onclick="() => { _sidebarOpen = false; StateHasChanged(); }"/>
    <AuthorizeView Roles="Admin">
        <SidepanelButton IconPath="icons/users.svg" 
                         Href="/dashboard/users" style="background-color: #ffffff00; justify-content: center; width: min-content;" 
                         @onclick="() => { _sidebarOpen = false; StateHasChanged(); }"/>
    </AuthorizeView>
    <div class="p-3 cursor-pointer" 
         @onclick="() => { _sidebarOpen = !_sidebarOpen; StateHasChanged(); }"><Icon Path="icons/menu.svg"/></div>
</div>