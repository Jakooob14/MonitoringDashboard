@using MonitoringDashboard.Components.Shared
@inherits MonitoringDashboard.Components.Shared.MonitoredServiceCardBase
@inject NavigationManager Nav

<div class="bg-zinc-800 p-6 rounded-sm flex justify-between items-center gap-4 shadow-lg border-s-4 @(ServiceUp ? "border-s-green-500" : "border-s-red-500")">
    <div>
        <h2 class="text-2xl font-bold">@MonitoredService.Name</h2>
        @* <span class="text-zinc-400 bg-[hsl(240,4%,20%)] border-[1px] border-zinc-600 px-2 rounded-sm">HTTP</span> *@
        <span class="text-zinc-400">@GetFormattedUptime()</span>
    </div>
    <div class="flex">
        <ServiceStatusBar Statuses="Statuses" FixedBarWidth="5"/>
        <div class="relative">
            <div @onclick="ToggleContextMenu">...</div>
            <ContextMenu style=@($"display: {(_contextMenuOpen ? "block" : "none")}") Items="_contextMenuItems" OnClose="() => _contextMenuOpen = false" />
        </div>
    </div>
</div>

@code {
    private bool _contextMenuOpen = false;

    private List<ContextMenu.ContextMenuItem> _contextMenuItems = [];

    protected override void OnInitialized()
    {
        _contextMenuItems =
        [
            new ContextMenu.ContextMenuItem
            {
                Text = "Edit",
                OnClick = () => Nav.NavigateTo($"/dashboard/services/edit/{MonitoredService.Id}")
            },
            new ContextMenu.ContextMenuItem
            {
                Text = "Delete"
            }
        ];
    }

    private void ToggleContextMenu()
    {
        _contextMenuOpen = !_contextMenuOpen;
    }
}