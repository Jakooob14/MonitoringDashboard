@page "/dashboard/profile"
@using Microsoft.AspNetCore.Components.Authorization
@using MonitoringDashboard.Components.Shared
@using MonitoringDashboard.Components.Shared.CascadingParameters
@inject AuthenticationStateProvider AuthStateProvider
@inject IServiceScopeFactory ScopeFactory
@inject NavigationManager Nav
@rendermode InteractiveServer

<AppPageTitle Value="Profile"/>

<h3>Profile</h3>

<EditForm FormName="editUser" Model="ProfileModel" OnValidSubmit="HandleEditProfile" class="flex flex-col gap-4">
    <DataAnnotationsValidator/>
    
    <div class="flex flex-col w-full">
        <label for="username">Username</label>
        <InputText class="input" id="username" @bind-Value="ProfileModel.UserName"/>
    </div>
    
    <div class="flex flex-col w-full">
        <label for="email">E-Mail</label>
        <InputText class="input" id="email" @bind-Value="ProfileModel.Email"/>
    </div>
    
    <div class="flex flex-col w-full">
        <button class="button-primary" type="button" @onclick="() => _changePasswordModalOpen = true">Change Password</button>
    </div>
    
    <ul class="text-red-400">
        @foreach (var error in _profileErrors)
        {
            <li>@error</li>
        }
    </ul>
    
    <button type="submit" class="input">Update</button>
</EditForm>

<Modal Title="Change Password" @bind-IsOpen="_changePasswordModalOpen" ShowFooter="false">
    <EditForm FormName="changePassword" Model="ChangePasswordModelValues" OnValidSubmit="HandleChangePassword" class="flex flex-col gap-4">
        <DataAnnotationsValidator/>
        
        <div class="flex flex-col w-full">
            <label for="currentPassword">Current Password</label>
            <InputText class="input" id="currentPassword" type="password" @bind-Value="ChangePasswordModelValues.CurrentPassword"/>
        </div>
        
        <div class="flex flex-col w-full">
            <label for="newPassword">New Password</label>
            <InputText class="input" id="newPassword" type="password" @bind-Value="ChangePasswordModelValues.NewPassword"/>
        </div>
        
        <div class="flex flex-col w-full">
            <label for="confirmNewPassword">Confirm New Password</label>
            <InputText class="input" id="confirmNewPassword" type="password" @bind-Value="ChangePasswordModelValues.ConfirmNewPassword"/>
        </div>
        
        <ul class="text-red-400">
            @foreach (var error in _passwordErrors)
            {
                <li>@error</li>
            }
        </ul>
        
        <button type="submit" class="input">Change Password</button>
        
    </EditForm>
</Modal>